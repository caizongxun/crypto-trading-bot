# 量化交易机器人 - 项目总结

## 项目阶段

### Phase 1: 指标开发 (当前阶段 - 已完成)

已创建一套完整的组合指标系统，结合成交量、动能、趋势和波动率分析。

**核心特性：**
- 多指标融合（RSI, MACD, 布林线, ATR, OBV等）
- 基于前一根K棒数据生成信号（避免数据泄露）
- 信号强度评分系统（0-1，可信度指标）
- 高度模块化和可配置

---

## 项目结构

```
crypto-trading-bot/
├── README.md                          # 项目简介
├── PROJECT_SUMMARY.md                 # 本文件
├── requirements.txt                   # Python依赖
├── main.py                            # Phase 2占位符：模型训练
├── index.py                           # 指标计算入口脚本
│
├── modules/                           # 可调整的模块化代码
│   ├── __init__.py
│   ├── indicators.py                  # 指标类定义
│   ├── feature_engineering.py         # 特征工程（未来使用）
│   └── model.py                       # 模型类定义（未来使用）
│
└── test/                              # 测试和可视化代码
    ├── __init__.py
    ├── INDICATOR_DESIGN.md            # 指标设计详解
    ├── QUICKSTART.md                  # 快速启动指南
    ├── indicator_test.py              # 指标测试套件
    ├── model_test.py                  # 模型测试（待实现）
    ├── visualization.py               # 指标可视化工具
    └── output_*.png                   # 可视化输出图表
```

---

## 指标系统设计

### 四维信号评分

```
交易信号 = f(动能得分, 趋势得分, 成交量得分, 波动率得分)
         = 0.35*Momentum + 0.35*Trend + 0.20*Volume + 0.10*Volatility
```

### 1. 动能得分 (Momentum Score) - 35%

**包含指标：**
- RSI (14): 超买超卖判断
- MACD (12,26,9): 趋势和动能
- Momentum (10): 价格变动速度
- ROC (12): 变化率

**信号强度：**
- RSI > 70 + MACD > 0 = 强看涨
- RSI < 30 + MACD < 0 = 强看跌

### 2. 趋势得分 (Trend Score) - 35%

**包含指标：**
- 价格相对SMA20的位置
- 价格相对布林带的位置
- SMA20 vs SMA50 对齐度

**信号强度：**
- 价格 > SMA20 > SMA50 = 强上升趋势
- 价格突破上轨 = 上升确认

### 3. 成交量得分 (Volume Score) - 20%

**包含指标：**
- 成交量倍增（相对平均值）
- OBV趋势（成交量方向）

**信号强度：**
- 成交量 > 1.5倍平均值 = 确认信号
- OBV创新高 = 强看多
- OBV创新低 = 强看空

### 4. 波动率得分 (Volatility Score) - 10%

**包含指标：**
- ATR (14): 真实波幅
- 布林带宽度：波动范围

**信号强度：**
- 中等波动 (5%-10%) = 最佳交易环境
- 极低波动后突升 = 突破机会
- 极高波动 = 谨慎对待

---

## 信号生成逻辑

### 买入信号 (Signal = 1)

**所有条件必须同时满足：**
1. 复合得分 > 0.4 (强烈看涨)
2. 成交量得分 > 0.2 (成交量确认)
3. 动能得分 > 0.2 (动能指标看好)
4. 趋势得分 > -0.3 (趋势不反对)

**真实案例：**
- RSI从30反弹至45 (看多)
- MACD柱状图由负转正 (动能起)
- 成交量突增1.5倍 (量能确认)
- 价格突破SMA20 (趋势确认)
→ 生成BUY信号，强度0.75

### 卖出信号 (Signal = -1)

**所有条件必须同时满足：**
1. 复合得分 < -0.4 (强烈看跌)
2. 成交量得分 > 0.2 (成交量确认)
3. 动能得分 < -0.2 (动能指标看空)
4. 趋势得分 < 0.3 (趋势不支持)

### 持有信号 (Signal = 0)

- 不满足买入或卖出条件
- 允许继续持有已有头寸
- 等待更清晰的信号

---

## 关键特性：前一根K棒数据

### 问题

在实时交易中，当前K棒仍在形成。价格不断变动导致指标持续更新，造成虚假信号。

```
10:05 - 10:06 K棒形成过程
├─ 10:05:01: Close=45000, RSI=65 → 建议买入
├─ 10:05:30: Close=45050, RSI=66 → 信号还有效
├─ 10:05:59: Close=44900, RSI=62 → 信号失效！
└─ 10:06:00: K棒完成，已无法回到之前的价格
```

### 解决方案

**使用前一根完整K棒的数据生成信号：**

```python
# 使用上个小时完整数据
momentum_prev = df['momentum_score'].shift(1)  # 前一根K棒
trend_prev = df['trend_score'].shift(1)
volume_prev = df['volume_score'].shift(1)

# 在新K棒开始时生成信号
# 10:06:00 K棒开始 → 使用10:05-10:06完整K棒数据生成信号
# 交易执行于10:06:00开盘价
```

**优势：**
- 避免数据泄露（未来数据）
- 信号稳定，不会变动
- 易于回测验证
- 实盘易于执行（按开盘价或限价下单）

---

## 信号强度评分

**计算公式：**
```
Strength = Agreement × Volume_Boost

where:
  Agreement = (|momentum_score| + |trend_score|) / 2
  Volume_Boost = (volume_score + 1) / 2
```

**分数含义：**
- **0.7 - 1.0**: 极度可靠，多个指标同向
- **0.5 - 0.7**: 中等可靠，大部分指标同向
- **0.3 - 0.5**: 弱信号，需要谨慎
- **< 0.3**: 信号微弱，建议忽略

---

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 测试指标系统
```bash
# 全面的指标测试
python test/indicator_test.py

# 特定币种的信号
python index.py BTCUSDT 1h

# 可视化分析
python test/visualization.py ETHUSDT 1h
```

### 3. 理解指标设计
```bash
cat test/INDICATOR_DESIGN.md      # 详细的设计文档
cat test/QUICKSTART.md             # 快速启动指南
```

---

## 支持的交易对（38个）

**主要币种：**
- BTC (BTCUSDT)
- ETH (ETHUSDT)
- SOL (SOLUSDT)
- BNB (BNBUSDT)
- XRP (XRPUSDT)
- ADA (ADAUSDT)
- DOGE (DOGEUSDT)

**完整列表见：**
```
AAVE, ADA, ALGO, ARB, ATOM, AVAX, BAL, BAT, BCH, BNB, BTC, COMP, CRV,
DOGE, DOT, ENJ, ENS, ETC, ETH, FIL, GALA, GRT, IMX, KAVA, LINK, LTC,
MANA, MATIC, MKR, NEAR, OP, SAND, SNX, SOL, SPELL, UNI, XRP, ZRX
```

---

## 支持的时间框架

- **15分钟** (15m): 日内短线
- **1小时** (1h): 日内中线
- **1天** (1d): 中长期趋势

---

## Phase 2: 模型验证（下一阶段）

### 规划内容

1. **特征工程**
   - 将指标信号转化为机器学习特征
   - 添加技术面、基本面特征
   - 特征标准化和选择

2. **模型训练**
   - XGBoost/LightGBM: 特征重要性分析
   - LSTM: 时间序列学习
   - 集成多个模型

3. **信号验证**
   - 用前一根K棒特征预测当前K棒收益
   - 精准度、召回率、F1分数
   - ROC-AUC曲线分析

4. **回测框架**
   - 基于真实K线的模拟交易
   - 计算胜率、盈利因子、夏普比
   - 最大回撤分析

5. **风险管理**
   - 止损设置（2%-5%）
   - 止盈目标（5%-15%）
   - 仓位管理
   - 最大单笔风险控制

---

## 数据来源

**HuggingFace Dataset ID：** `zongowo111/v2-crypto-ohlcv-data`

**数据特点：**
- OHLCV格式 (Open, High, Low, Close, Volume)
- Binance K线数据
- UTC时间
- 已去重处理
- 时间序列完整

---

## 技术栈

- **数据处理**: pandas, numpy
- **机器学习**: scikit-learn, xgboost, torch (后期)
- **可视化**: matplotlib, seaborn
- **数据获取**: huggingface_hub

---

## 项目特点

1. **模块化设计**
   - 指标、特征、模型独立分离
   - 易于修改和扩展
   - 支持不同策略组合

2. **生产级别的代码质量**
   - 完整的错误处理
   - 清晰的代码注释
   - 全面的测试覆盖

3. **避免常见陷阱**
   - 使用前一根K棒（无数据泄露）
   - 信号强度评分（可信度指标）
   - 成交量确认（避免虚假突破）

4. **易于理解的信号逻辑**
   - 四维评分系统清晰直观
   - 每个维度都有物理意义
   - 易于进行参数优化

---

## 未来改进方向

1. **指标优化**
   - 适应性参数调整
   - 市场制度自适应
   - 多周期共振

2. **模型增强**
   - 深度学习模型
   - 注意力机制 (Transformer)
   - 多任务学习

3. **系统完善**
   - 实时数据接入
   - 自动交易执行
   - 性能监控面板
   - 风险告警系统

4. **策略多元化**
   - 多周期策略
   - 配对交易
   - 套利策略
   - 波动率策略

---

## 许可证

MIT

---

## 免责声明

本项目仅供学习和研究之用。加密货币交易具有高风险。在进行实际交易前，请充分了解市场风险并咨询专业人士。

过去的表现不代表未来结果。所有交易决定应基于自己的分析和风险承受能力。

---

## 更新日志

### v1.0 (2026-01-13)
- 完成Phase 1指标系统
- 实现四维信号评分
- 开发可视化工具
- 完成测试套件

---

**下一步:** 上传模型训练代码进行Phase 2开发
